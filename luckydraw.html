<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>LUCKY DRAW | ARA BG COMMUNITY</title>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;1,400&family=Quicksand:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    
    <style>
        :root {
            --bg-silk: #FDF9F3;
            --matcha-leaf: #6B7A68;
            --clay-text: #4A443F;
            --white-pure: #FFFFFF;
            --gold-leaf: #D4AF37;
            --pebble-shadow: rgba(74, 68, 63, 0.12);
        }

        html { overflow-x: hidden; max-width: 100vw; }

        body {
            margin: 0; padding: 0; width: 100%; max-width: 100vw; overflow-x: hidden;
            background-color: var(--bg-silk);
            background-image: url("https://www.transparenttextures.com/patterns/paper.png");
            background-attachment: fixed;
            color: var(--clay-text);
            font-family: 'Quicksand', sans-serif;
            display: flex; flex-direction: column; align-items: center; min-height: 100vh;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        nav {
            width: 100%; background: rgba(253, 249, 243, 0.98); backdrop-filter: blur(10px);
            position: sticky; top: 0; z-index: 1000; padding: 15px 5px;
            border-bottom: 1px solid rgba(107, 122, 104, 0.08);
        }
        .nav-links { display: flex; justify-content: center; gap: clamp(15px, 4vw, 40px); }
        .nav-item {
            color: var(--clay-text); text-decoration: none; font-size: 0.75rem;
            text-transform: uppercase; letter-spacing: 2px; font-weight: 500; opacity: 0.7;
        }
        .nav-item.active { color: var(--matcha-leaf); font-weight: 700; border-bottom: 2px solid var(--gold-leaf); }

        header { padding: 25px 15px 10px; text-align: center; width: 100%; }
        h1 { font-family: 'Playfair Display', serif; font-style: italic; font-weight: 400; color: var(--matcha-leaf); font-size: clamp(1.8rem, 5vw, 3rem); margin: 0; }

        .setup-container {
            width: 92%; max-width: 1000px; margin: 20px auto;
            background: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 10px 30px var(--pebble-shadow);
            display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px;
        }
        .input-group h3 { margin: 0 0 5px 0; font-family: 'Playfair Display', serif; color: var(--matcha-leaf); }
        .input-group small { display: block; margin-bottom: 8px; font-size: 0.8rem; opacity: 0.8; }
        textarea { width: 100%; height: 100px; border: 1px solid #ddd; border-radius: 10px; padding: 10px; font-family: inherit; font-size: 0.85rem; }
        .lock-btn { grid-column: 1 / -1; padding: 15px; background: var(--matcha-leaf); color: white; border: none; border-radius: 35px; cursor: pointer; letter-spacing: 2px; font-weight: 700; text-transform: uppercase; width: 100%; }

        .game-section { width: 94%; max-width: 1100px; margin: 30px auto; }
        .pot-title { font-family: 'Playfair Display', serif; color: var(--matcha-leaf); font-size: clamp(1.4rem, 4vw, 1.8rem); border-bottom: 1px solid var(--gold-leaf); margin-bottom: 20px; padding-bottom: 10px; display: flex; justify-content: space-between; align-items: baseline; }
        .pot-rules { font-family: 'Quicksand'; font-size: 0.75rem; color: var(--clay-text); letter-spacing: 1px; text-transform: uppercase; }
        .prizes-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; width: 100%; }
        @media (max-width: 1024px) { .prizes-grid { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 600px) { .prizes-grid { grid-template-columns: 1fr; } }

        .prize-card { position: relative; height: 300px; border-radius: 15px; overflow: hidden; background-color: #eee; cursor: pointer; transition: transform 0.3s ease; box-shadow: 0 10px 20px var(--pebble-shadow); border: 1px solid rgba(0,0,0,0.05); }
        .game-img { width: 100%; height: 100%; object-fit: cover; }
        .card-overlay { position: absolute; bottom: 0; left: 0; right: 0; background: linear-gradient(transparent, rgba(0,0,0,0.85)); padding: 20px 15px; color: white; text-align: center; }
        .winner-display { color: var(--gold-leaf); font-weight: 700; font-size: 0.9rem; margin-top: 5px; }
        .prize-card.drawn { pointer-events: none; filter: grayscale(0.6); }
        .prize-card.drawn::after { content: "DRAWN"; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-15deg); font-weight: 900; font-size: 1.8rem; color: white; border: 3px solid white; padding: 10px 20px; background: rgba(0,0,0,0.2); border-radius: 10px; }

        /* --- MODAL UPDATES FOR TABLET SAFETY --- */
        .modal { 
            display: none; position: fixed; z-index: 2000; left: 0; top: 0; 
            width: 100%; height: 100%; background: rgba(0,0,0,0.96); 
            /* SAFETY SCROLL: Only activates if physical screen is too small */
            overflow-y: auto; 
            padding: 10px; 
            align-items: center; justify-content: center; 
        }
        
        .modal-content-wrapper { 
            margin: auto; display: flex; flex-direction: column; align-items: center; 
            justify-content: center; width: 100%; max-width: 1000px; 
            min-height: min-content; /* Ensure container shrinks to fit content */
            outline: none; position: relative; 
        }
        
        /* Close button container with distinct spacing */
        .close-btn-container { width: 100%; max-width: 800px; display: flex; justify-content: flex-end; margin-bottom: 5px; }
        .close-icon { color: white; font-size: 2.5rem; cursor: pointer; padding: 5px 15px; line-height: 1; opacity: 0.8; }
        .close-icon:hover { opacity: 1; color: var(--gold-leaf); }

        .modal-layout { 
            display: flex; flex-direction: row; align-items: center; justify-content: center; 
            gap: clamp(10px, 3vw, 40px); width: 100%; margin-bottom: 10px; 
        }

        .modal-image-col { flex: 0 1 auto; display: flex; justify-content: center; align-items: center; }

        /* DYNAMIC HEIGHT SCALING: Uses 'vh' to shrink image on short screens */
        #modalPrizeImg { 
            width: auto; max-width: 100%; height: auto; 
            max-height: 25vh; /* Takes up max 25% of viewport height */
            object-fit: contain; border-radius: 12px; border: 3px solid var(--gold-leaf); 
            box-shadow: 0 0 30px rgba(212, 175, 55, 0.3); background: #000; 
        }

        /* DYNAMIC WHEEL SCALING: Uses 'vh' to shrink wheel on short screens */
        .wheel-container { 
            position: relative; 
            width: 35vh; height: 35vh; 
            max-width: 350px; max-height: 350px; /* Upper limit */
            min-width: 220px; min-height: 220px; /* Lower limit */
            flex-shrink: 0; 
        }
        
        canvas { width: 100%; height: 100%; border-radius: 50%; border: 6px solid var(--white-pure); }
        
        .pointer { 
            position: absolute; top: -12px; left: 50%; transform: translateX(-50%); 
            width: 0; height: 0; border-left: 18px solid transparent; 
            border-right: 18px solid transparent; border-top: 36px solid var(--gold-leaf); 
            z-index: 10; filter: drop-shadow(0 0 2px white) drop-shadow(0 2px 4px rgba(0,0,0,0.5)); 
        }

        .winner-announce { 
            font-family: 'Playfair Display', serif; font-size: clamp(2rem, 5vw, 3.5rem); 
            font-weight: 700; color: var(--gold-leaf); text-align: center; 
            min-height: 60px; /* Reduced vertical footprint */
            opacity: 0; transform: scale(0.5); transition: all 0.5s; 
            display: flex; align-items: center; justify-content: center; 
        }
        .winner-announce.show { opacity: 1; transform: scale(1); text-shadow: 0 0 30px rgba(212, 175, 55, 0.7); animation: pulseGlow 2s infinite; }
        @keyframes pulseGlow { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.05); } }

        .spin-btn { 
            background: var(--gold-leaf); color: white; padding: 15px 50px; 
            font-size: 1.1rem; border-radius: 50px; border: none; cursor: pointer; 
            font-weight: 700; letter-spacing: 2px; box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4); 
            margin-bottom: 20px; flex-shrink: 0; 
        }

        /* --- TABLET PORTRAIT / MOBILE FIXES --- */
        @media (max-width: 900px) {
            .modal-layout { flex-direction: column; gap: 15px; }
            #modalPrizeImg { max-height: 20vh; } 
            .wheel-container { width: 30vh; height: 30vh; }
            .close-icon { padding: 5px 10px; }
        }
        
        /* --- LANDSCAPE TABLET FIXES (Short Screens) --- */
        @media (max-height: 700px) {
            .modal-layout { flex-direction: row; gap: 20px; }
            #modalPrizeImg { max-height: 35vh; }
            .wheel-container { width: 35vh; height: 35vh; }
            .spin-btn { padding: 10px 30px; margin-bottom: 10px; }
            .winner-announce { font-size: 2rem; min-height: 50px; }
        }
    </style>
</head>
<body>
    <nav><div class="nav-links"><a href="index.html" class="nav-item">The Porch</a><a href="#" class="nav-item active">Lucky Draw</a></div></nav>
    <header><h1>Lucky Draw - 14 February 2026</h1></header>

    <section class="setup-container" id="setupArea">
        <div class="input-group"><h3>ðŸ”µ Option A</h3><small>Counts x2. Included in Pot A draws.</small><textarea id="listA" placeholder="Names for Option A..."></textarea></div>
        <div class="input-group"><h3>ðŸŸ¢ Option B</h3><small>Counts x2. Included in Pot B draws.</small><textarea id="listB" placeholder="Names for Option B..."></textarea></div>
        <div class="input-group"><h3>ðŸŸ¡ Option C</h3><small>Counts x1. Included in ALL draws.</small><textarea id="listC" placeholder="Names for Option C..."></textarea></div>
        <button class="lock-btn" onclick="lockLists()">Lock & Initialize Draw</button>
    </section>

    <main id="gameArea" style="opacity: 0.5; pointer-events: none;">
        <section class="game-section">
            <div class="pot-title">Pot A Prizes <span class="pot-rules">Option A (x2) + Option C (x1)</span></div>
            <div class="prizes-grid">
                <div class="prize-card" onclick="openDraw('Option A', 'Maracaibo', this)"><img src="luckydraw/maracaibo.webp" class="game-img"><div class="card-overlay"><h4>Maracaibo</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option A', 'Tea Garden', this)"><img src="luckydraw/teagarden.webp" class="game-img"><div class="card-overlay"><h4>Tea Garden</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option A', 'Bag of Chips', this)"><img src="luckydraw/bag.webp" class="game-img"><div class="card-overlay"><h4>Bag of Chips</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option A', 'Beacon Patrol', this)"><img src="luckydraw/beacon.webp" class="game-img"><div class="card-overlay"><h4>Beacon Patrol</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option A', 'Coexist', this)"><img src="luckydraw/coexist.webp" class="game-img"><div class="card-overlay"><h4>Coexist</h4><div class="winner-display"></div></div></div>
            </div>
        </section>
        <section class="game-section">
            <div class="pot-title">Pot B Prizes <span class="pot-rules">Option B (x2) + Option C (x1)</span></div>
            <div class="prizes-grid">
                <div class="prize-card" onclick="openDraw('Option B', 'Dead by Daylight', this)"><img src="luckydraw/deadbydaylight.webp" class="game-img"><div class="card-overlay"><h4>Dead by Daylight</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option B', 'Potion Explosion', this)"><img src="luckydraw/potion.webp" class="game-img"><div class="card-overlay"><h4>Potion Explosion</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option B', 'Alma Mater', this)"><img src="luckydraw/alma.webp" class="game-img"><div class="card-overlay"><h4>Alma Mater</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option B', 'Kanagawa', this)"><img src="luckydraw/kanagawa.webp" class="game-img"><div class="card-overlay"><h4>Kanagawa</h4><div class="winner-display"></div></div></div>
                <div class="prize-card" onclick="openDraw('Option B', 'Bag of Chips', this)"><img src="luckydraw/bag.webp" class="game-img"><div class="card-overlay"><h4>Bag of Chips</h4><div class="winner-display"></div></div></div>
            </div>
        </section>
    </main>

    <div id="wheelModal" class="modal">
        <div class="modal-content-wrapper">
            <div class="close-btn-container"><span class="close-icon" onclick="closeModal()">âœ•</span></div>
            <div class="modal-layout">
                <div class="modal-image-col"><img id="modalPrizeImg" src="" alt="Prize Image"></div>
                <div class="wheel-container"><div class="pointer"></div><canvas id="wheelCanvas" width="380" height="380"></canvas></div>
            </div>
            <div id="winnerText" class="winner-announce"></div>
            <button id="spinBtn" class="spin-btn" onclick="spinWheel()">SPIN THE WHEEL</button>
        </div>
    </div>

    <audio id="tickSound" src="https://cdn.freesound.org/previews/25/25737_122699-lq.mp3"></audio>
    <audio id="winSound" src="https://cdn.freesound.org/previews/270/270404_5123851-lq.mp3"></audio>

    <script>
        let namesA = [], namesB = [], namesC = [], pastWinners = new Set();
        let currentPool = [], currentCard = null, isSpinning = false;
        const canvas = document.getElementById('wheelCanvas'), ctx = canvas.getContext('2d');
        const colors = ['#6B7A68', '#4A443F', '#D4AF37', '#8A9A88', '#B89E8D'];

        function lockLists() {
            namesA = document.getElementById('listA').value.split('\n').map(n=>n.trim()).filter(n => n);
            namesB = document.getElementById('listB').value.split('\n').map(n=>n.trim()).filter(n => n);
            namesC = document.getElementById('listC').value.split('\n').map(n=>n.trim()).filter(n => n);
            if([...namesA, ...namesB, ...namesC].length === 0) return;
            document.getElementById('setupArea').style.display = 'none';
            document.getElementById('gameArea').style.opacity = '1';
            document.getElementById('gameArea').style.pointerEvents = 'auto';
        }

        function openDraw(optionType, game, el) {
            currentCard = el;
            document.getElementById('modalPrizeImg').src = el.querySelector('.game-img').src;
            document.getElementById('wheelModal').style.display = 'flex';
            document.body.style.overflow = 'hidden'; 
            document.getElementById('winnerText').classList.remove('show');
            document.getElementById('spinBtn').style.display = 'block';
            currentPool = [];
            let entryList = (optionType === 'Option A') ? namesA : namesB;
            entryList.forEach(n => { if(!pastWinners.has(n)) { currentPool.push(n); currentPool.push(n); } });
            namesC.forEach(n => { if(!pastWinners.has(n)) { currentPool.push(n); } });
            currentPool.sort(() => Math.random() - 0.5);
            if(currentPool.length === 0) { closeModal(); return; }
            drawWheel(0);
        }

        function drawWheel(rot) {
            let num = currentPool.length;
            let arc = (2 * Math.PI) / num;
            ctx.clearRect(0,0,380,380);
            ctx.save(); ctx.translate(190,190); ctx.rotate(rot);
            for(let i=0; i<num; i++){
                ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,185, i*arc, (i+1)*arc);
                ctx.fillStyle = colors[i % colors.length]; ctx.fill();
                if(num < 40) {
                    ctx.save(); ctx.rotate(i*arc + arc/2); ctx.fillStyle="white";
                    ctx.font="bold 12px Quicksand"; ctx.fillText(currentPool[i].substring(0,15), 60, 5); ctx.restore();
                }
            }
            ctx.restore();
        }

        function launchConfetti() {
            var duration = 3000;
            var end = Date.now() + duration;
            (function frame() {
                confetti({ particleCount: 7, angle: 60, spread: 55, origin: { x: 0 }, colors: ['#D4AF37', '#6B7A68', '#FFFFFF'], zIndex: 9999 });
                confetti({ particleCount: 7, angle: 120, spread: 55, origin: { x: 1 }, colors: ['#D4AF37', '#6B7A68', '#FFFFFF'], zIndex: 9999 });
                if (Date.now() < end) requestAnimationFrame(frame);
            }());
        }

        function spinWheel() {
            if(isSpinning) return;
            isSpinning = true;
            document.getElementById('spinBtn').style.display = 'none';
            let winnerIdx = Math.floor(Math.random() * currentPool.length);
            let winner = currentPool[winnerIdx];
            let arc = (2 * Math.PI) / currentPool.length;
            let finalRot = (3*Math.PI/2) - (winnerIdx * arc + arc/2) + (Math.PI * 10);
            let start = null;
            function animate(time) {
                if(!start) start = time;
                let prog = (time - start) / 5000;
                let ease = 1 - Math.pow(1 - Math.min(prog, 1), 3);
                drawWheel(ease * finalRot);
                if(prog < 1) requestAnimationFrame(animate);
                else {
                    isSpinning = false;
                    document.getElementById('winnerText').innerText = winner;
                    document.getElementById('winnerText').classList.add('show');
                    pastWinners.add(winner);
                    currentCard.classList.add('drawn');
                    currentCard.querySelector('.winner-display').innerText = "Won by " + winner;
                    document.getElementById('winSound').play();
                    launchConfetti();
                }
            }
            requestAnimationFrame(animate);
        }

        function closeModal() { if(!isSpinning) { document.getElementById('wheelModal').style.display = 'none'; document.body.style.overflow = ''; } }
    </script>
</body>
</html>